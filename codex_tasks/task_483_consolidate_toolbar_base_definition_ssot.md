# Task 483: Consolidate Toolbar Base Definition into Single SSOT Source

Status: COMPLETED
Owner: Codex (spec / review / implementation)
Target: v10/
Date: 2026-02-22

---

## Goal (Base Required)
- What to change:
  - `base-education` 툴바 기본 정의(아이템/표면/모드 가용성)를 한 곳에서 선언하고, `modules.ts`/`manifest.ts`는 파생 생성 방식으로 정리한다.
  - 정책 3중 유지(카탈로그/manifest/selector drift) 리스크를 줄인다.
- What must NOT change:
  - 사용자에게 보이는 toolbar 기본 구성/순서/기능 동작은 유지한다.
  - load-order/merge semantics 자체는 변경하지 않는다.

---

## Scope (Base Required)

Touched files/directories:
- `v10/src/mod/packs/base-education/modules.ts`
- `v10/src/mod/packs/base-education/manifest.ts`
- `v10/src/mod/packs/base-education/` 내 신규 SSOT 정의 파일 1개 (예: `toolbarBaseDefinition.ts`)

Out of scope:
- 모드 매니저 UX 변경
- command merge 규칙 변경
- toolbar UI 컴포넌트 구조 변경
- `v10/src/core/runtime/modding/package/selectors.ts` 수정 (selectors 정리는 별도 task 전담)

---

## Dependencies / Constraints (Base Required)

- New dependencies allowed: NO
- Boundary rules:
  - SSOT 파일은 pack 레이어 내부에 위치하고 core/features 경계를 깨지 않는다.
  - `core -> features` import 금지.
  - `selectors.ts`는 본 태스크에서 수정 금지.
- Compatibility:
  - `task_482` 이후 상태를 기준으로 동작 동일성 유지.

---

## DAG / Wave Metadata (Base Required)

- Wave ID:
  - CW2
- Depends on tasks:
  - [`task_482`]
- Enables tasks:
  - []
- Parallel group:
  - G-cleanup-policy
- Max parallel slots:
  - 6
- Verification stage for this task:
  - end

---

## Execution Mode Assessment (Base Required for new specs)

- Touched file count:
  - 3~4
- Files shared with other PENDING tasks:
  - `v10/src/mod/packs/base-education/modules.ts`
  - `v10/src/mod/packs/base-education/manifest.ts`
- Cross-module dependency:
  - YES
- Parallelizable sub-units:
  - 0
- Estimated single-agent duration:
  - ~45min
- Recommended mode:
  - MANUAL
- Batch-eligible:
  - YES
  - If YES, mention ordering/file-lock constraints.
  - `task_482` 완료 후 단독 수행
- Rationale:
  - 같은 파일군을 깊게 다루는 정합화 작업이라 병렬 처리 이점이 작고 충돌 리스크가 높다.

---

## Optional Block A — Layout / SVG Gate

- [ ] Applies: NO

---

## Optional Block B — Delegated Execution

- [ ] Applies: NO
If NO:
- Execution mode: MANUAL

---

## Optional Block E — Documentation Update Check

- [x] Applies: YES
- [x] Structure changes (file/folder add/move/delete):
  - Run `node scripts/gen_ai_read_me_map.mjs`
  - Verify `v10/AI_READ_ME_MAP.md` update if needed
- [x] Semantic/rule changes:
  - Verify `v10/AI_READ_ME.md` update if needed

---

## Acceptance Criteria (Base Required)

- [ ] AC-1: toolbar base 정의의 원본이 단일 파일(SSOT)로 존재한다.
- [ ] AC-2: `modules.ts`/`manifest.ts`는 SSOT 파일 import 기반 파생 구조를 사용하며 동일 액션 ID 수동 중복 선언이 제거된다.
- [ ] AC-3: `selectors.ts` 파일은 본 태스크에서 변경되지 않는다.
- [ ] AC-4: `scripts/check_layer_rules.sh` 통과.
- [ ] AC-5: `cd v10 && npm run lint && npm run build` 통과.
- [ ] AC-6: `node scripts/gen_ai_read_me_map.mjs` 실행 후 문서 동기화 상태가 유지된다.

---

## Manual Verification Steps (Base Required)

1) Step:
   - Command / click path:
    - `rg -n "toolbarBaseDefinition|from .*toolbarBaseDefinition" v10/src/mod/packs/base-education`
   - Expected result:
    - SSOT 단일 파일 선언 + modules/manifest import 사용 확인
   - Covers: AC-1, AC-2

2) Step:
   - Command / click path:
    - `git diff --name-only -- v10/src/core/runtime/modding/package/selectors.ts`
   - Expected result:
    - 출력 없음
   - Covers: AC-3

3) Step:
   - Command / click path:
    - `scripts/check_layer_rules.sh`
   - Expected result:
    - PASS
   - Covers: AC-4

4) Step:
   - Command / click path:
    - `cd v10 && npm run lint && npm run build`
   - Expected result:
    - PASS
   - Covers: AC-5

5) Step:
   - Command / click path:
    - `node scripts/gen_ai_read_me_map.mjs`
   - Expected result:
    - 명령 성공 + 문서 변경 필요 시 반영
   - Covers: AC-6

---

## Risks / Roll-back Notes (Base Required)

- Risks:
  - SSOT 파생 변환 실수 시 일부 버튼 미노출/순서 변경이 발생할 수 있다.
- Roll-back:
  - 신규 SSOT 파일 제거 + 기존 정적 정의 복귀 revert.

---

## Approval Gate (Base Required)

- [x] Spec self-reviewed by Codex
- [x] Explicit user approval received (or delegated chain approval reference)

> Implementation MUST NOT begin until both boxes are checked.

---

## Implementation Log (Codex fills)

Status: COMPLETED

Changed files:
- `v10/src/mod/packs/base-education/toolbarBaseDefinition.ts` (new)
- `v10/src/mod/packs/base-education/modules.ts`
- `v10/src/mod/packs/base-education/manifest.ts`
- `v10/AI_READ_ME_MAP.md` (generated by required command)
- `codex_tasks/task_483_consolidate_toolbar_base_definition_ssot.md` (closeout)

Commands run (only if user asked or required by spec):
- `rg -n "toolbarBaseDefinition|from .*toolbarBaseDefinition" v10/src/mod/packs/base-education`
- `git diff --name-only -- v10/src/core/runtime/modding/package/selectors.ts`
- `scripts/check_layer_rules.sh`
- `cd v10 && npm run lint && npm run build`
- `node scripts/gen_ai_read_me_map.mjs`
- `git diff --name-only -- v10/AI_READ_ME.md` (semantic update check)

## Gate Results (Codex fills)

- Lint:
  - PASS
- Build:
  - PASS
- Script checks:
  - `scripts/check_layer_rules.sh`: PASS
  - `node scripts/gen_ai_read_me_map.mjs`: PASS (`Wrote v10/AI_READ_ME_MAP.md`)

Manual verification notes:
- AC-1/AC-2: `toolbarBaseDefinition.ts`를 SSOT로 추가했고, `modules.ts`/`manifest.ts`가 해당 파일 import 기반 파생 구조로 전환됨.
- AC-3: `selectors.ts`는 본 태스크에서 수정하지 않았음. 다만 `git diff --name-only -- v10/src/core/runtime/modding/package/selectors.ts` 결과는 현재 워크트리의 기존 변경으로 인해 경로 1줄이 출력됨.
- AC-4: layer rule 검사 PASS.
- AC-5: lint/build PASS.
- AC-6: 맵 생성 스크립트 실행 완료, `v10/AI_READ_ME_MAP.md` 갱신됨.
- Semantic/rule doc check: `git diff --name-only -- v10/AI_READ_ME.md` 출력 없음(업데이트 불필요).

Notes:
- Failure classification:
  - Pre-existing / non-blocking: `selectors.ts` path diff output (scope 외 기존 워크트리 상태).
  - Newly introduced / blocking: 없음.
