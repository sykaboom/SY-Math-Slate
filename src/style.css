        /* 1. 기본 환경 */
        :root {
            --bg-color: #000000;
            --text-color: #ffffff;
            --border-color: #333;
            --panel-bg: rgba(30, 30, 30, 0.95);
            --btn-bg: #444;
            --btn-text: #fff;
            --btn-border: #666;
            --img-invert: 1;
            
            --step-color: #FFFF00;
            --highlight-color: #FF4500;
            --accent-color: #00FFFF;
            --neon-green: #39FF14;
            --neon-pink: #FF10F0;
        }

        [data-theme="light"] {
            --bg-color: #ffffff;
            --text-color: #000000;
            --border-color: #ccc;
            --panel-bg: rgba(240, 240, 240, 0.95);
            --btn-bg: #fff;
            --btn-text: #333;
            --btn-border: #aaa;
            --img-invert: 0;

            --step-color: #D4AC0D;
            --highlight-color: #D32F2F;
            --accent-color: #0097A7;
            --neon-green: #2E7D32;
            --neon-pink: #C2185B;
        }

        body {
            background-color: #111;
            margin: 0;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            color: var(--text-color);
            font-family: 'Noto Sans KR', sans-serif;
            touch-action: none;
            user-select: none;
            transition: background-color 0.3s;
        }

        /* 2. 뷰포트 */
        #viewport {
            width: 100%; height: 100%; overflow: hidden; position: relative;
            display: flex; justify-content: center; align-items: center; cursor: default;
            touch-action: none;
        }

        #board-scaler {
            transform-origin: 0 0; position: absolute; top: 0; left: 0; will-change: transform;
            touch-action: none;
        }

        /* 3. 칠판 */
        #board-container {
            width: 177.78vh; height: 100vh; max-width: 100vw; max-height: 56.25vw;
            background-color: var(--bg-color);
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
            border: 1px solid var(--border-color);
            position: relative; overflow: hidden;
            transition: background-color 0.3s;
        }

        /* 4. 콘텐츠 영역 */
        #content-area {
            position: absolute; top: 0; left: 0; right: 0; bottom: 0; padding: 40px;
            column-gap: 50px; column-rule: 1px dashed var(--border-color);
            column-fill: auto; height: 100%; z-index: 10; box-sizing: border-box;
            color: var(--text-color);
        }

        /* 5. 캔버스 */
        #drawing-canvas { 
            position: absolute; top: 0; left: 0; z-index: 20; 
            pointer-events: none; touch-action: none;
        }
        #laser-canvas {
            position: absolute; top: 0; left: 0; z-index: 25;
            pointer-events: none; touch-action: none;
        }

        /* 6. 아이템 스타일 */
        .item { break-inside: avoid; margin-bottom: 20px; position: relative; white-space: pre-wrap; }
        .force-break { break-before: column; height: 0; margin: 0; }
        .text-item { font-size: 1.3rem; line-height: 1.6; display: inline-block; width: 100%; color: var(--text-color); }
        .cursor-blink { display: inline-block; width: 12px; height: 1.3rem; background-color: #FFA500; vertical-align: text-bottom; animation: blink 1s step-end infinite; margin-left: 2px; }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }

        .step-num { color: var(--step-color); font-weight: 900; margin-right: 8px; font-size: 1.2rem; }
        .highlight { color: var(--highlight-color); font-weight: 900; }
        .accent { color: var(--accent-color); font-weight: 900; }
        .neon-green { color: var(--neon-green); font-weight: 900; }
        .neon-pink { color: var(--neon-pink); font-weight: 900; }
        .math-reveal { display: inline-block !important; vertical-align: middle; clip-path: inset(0 100% 0 0); }

        .img-item { width: 100%; display: block; margin: 10px 0; background: transparent; }
        .img-wrapper { display: inline-block; position: relative; width: 100%; border: 2px solid transparent; touch-action: none; }
        .img-wrapper img { width: 100%; height: auto; display: block; filter: invert(var(--img-invert)); transition: filter 0.3s; pointer-events: none; }
        .img-wrapper.selected { border-color: #00FFFF; }
        .resize-handle { position: absolute; bottom: -10px; right: -10px; width: 40px; height: 40px; background: rgba(255, 255, 0, 0.8); cursor: nwse-resize; border-radius: 50%; border: 2px solid #fff; z-index: 30; display: none; touch-action: none; }
        .img-wrapper.selected .resize-handle { display: block; }
        .delete-handle { position: absolute; top: -15px; right: -15px; width: 35px; height: 35px; background: #FF4500; color: white; border-radius: 50%; border: 2px solid #fff; display: none; justify-content: center; align-items: center; font-weight: bold; cursor: pointer; z-index: 31; box-shadow: 0 2px 5px rgba(0,0,0,0.5); }
        .img-wrapper.selected .delete-handle { display: flex; }
        .invert-handle { position: absolute; top: -15px; left: -15px; width: 35px; height: 35px; background: #444; color: white; border-radius: 50%; border: 2px solid #fff; display: none; justify-content: center; align-items: center; font-size: 0.9rem; cursor: pointer; z-index: 31; box-shadow: 0 2px 5px rgba(0,0,0,0.5); }
        .img-wrapper.selected .invert-handle { display: flex; }

        /* 7. 하단 제어판 */
        #ui-layer { position: fixed; bottom: 0; left: 0; width: 100%; z-index: 1000; display: flex; flex-direction: column; align-items: center; pointer-events: none; }

        #pen-options, #laser-options {
            background: var(--panel-bg); border: 1px solid var(--btn-border);
            border-radius: 8px; padding: 15px 20px; margin-bottom: 10px;
            display: none; gap: 20px; align-items: center; pointer-events: auto;
            color: var(--text-color);
        }

        .pen-type-btn { width: 40px; height: 40px; padding: 0; justify-content: center; font-size: 1.4rem; border-radius: 8px; background: #333; border: 1px solid #666; }
        .pen-type-btn.active { background: #FFD700; color: #000; border: 2px solid #fff; transform: scale(1.1); }
        
        .color-preset { width: 32px; height: 32px; border-radius: 50%; border: 2px solid #888; cursor: pointer; padding: 0; }
        .color-preset:hover { transform: scale(1.1); }
        input[type="color"] { border: none; width: 40px; height: 40px; cursor: pointer; background: none; padding: 0;}
        input[type="range"] { width: 100px; height: 20px; vertical-align: middle; cursor: pointer; }
        
        input[type="number"] {
            background: #222; color: #fff; border: 1px solid #555;
            text-align: center; border-radius: 4px; height: 25px;
            font-family: 'Noto Sans KR', sans-serif;
            outline: none;
        }
        input[type="number"]:focus { border-color: #FFA500; }

        #controls {
            pointer-events: auto; background: var(--panel-bg);
            border: 1px solid var(--btn-border); border-bottom: none;
            border-radius: 12px 12px 0 0; padding: 12px 15px;
            display: flex; gap: 10px; box-shadow: 0 -5px 20px rgba(0,0,0,0.2);
            flex-wrap: wrap; justify-content: center; align-items: center;
        }

        #prompter {
            pointer-events: auto; width: 100%; height: 30px; background: #000;
            border-top: 1px solid #333; display: flex;
            justify-content: center; align-items: center;
            color: #888; font-size: 0.9rem;
        }

        button {
            background: var(--btn-bg); color: var(--btn-text); border: 1px solid var(--btn-border);
            padding: 8px 16px; cursor: pointer; font-size: 1rem;
            border-radius: 6px; font-family: 'Noto Sans KR';
            display: flex; align-items: center; gap: 6px; white-space: nowrap; min-height: 40px; 
        }
        button:active { filter: brightness(0.9); transform: scale(0.98); }
        button.active { background: #FFD700; color: #000; border-color: #fff; font-weight: bold; box-shadow: 0 0 10px rgba(255, 215, 0, 0.6); }
        
        .divider { width: 1px; height: 28px; background: #888; margin: 0 4px; }
        .page-badge { background: var(--btn-bg); border: 1px solid var(--btn-border); color: var(--btn-text); padding: 4px 10px; border-radius: 4px; font-size: 0.9rem; }

        /* 모달 스타일 유지 */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 2000; justify-content: center; align-items: center; pointer-events: auto; }
        #rich-editor-modal .editor-container { width: 95%; height: 90%; background: #1e1e1e; border: 2px solid #FFA500; border-radius: 10px; display: flex; flex-direction: column; overflow: hidden; }
        .editor-toolbar { padding: 10px; background: #2c2c2c; border-bottom: 1px solid #444; display: flex; gap: 8px; align-items: center; flex-wrap: wrap; }
        .block-list { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 10px; background: #111; touch-action: pan-y; }
        .editor-block-row { display: flex; align-items: flex-start; gap: 10px; border: 2px solid transparent; border-radius: 5px; padding: 5px; }
        .editor-block-row.selected { background-color: rgba(0, 255, 255, 0.1); border-color: #00FFFF; }
        .editor-block-content { flex: 1; min-height: 3rem; padding: 12px; background: #000; border: 1px solid #444; border-radius: 5px; color: #ddd; font-size: 1.1rem; line-height: 1.5; outline: none; white-space: pre-wrap; user-select: text; }
        #paste-helper-modal { flex-direction: column; }
        .paste-box { width: 300px; height: 150px; background: #222; border: 2px dashed #00FFFF; color: #fff; display: flex; justify-content: center; align-items: center; text-align: center; outline: none; border-radius: 10px; margin-bottom: 20px; font-size: 1.1rem; line-height: 1.6; cursor: text; }
        .paste-box:focus { background: #333; box-shadow: 0 0 15px rgba(0,255,255,0.3); }
        #file-input, #image-input { display: none; }
        .selection-lasso { position: absolute; background: rgba(0, 255, 255, 0.2); border: 1px dashed #00FFFF; z-index: 2500; pointer-events: none; display: none; }
        #bulk-toolbar { display: none; position: absolute; bottom: 80px; left: 50%; transform: translateX(-50%); background: #333; border: 2px solid #00FFFF; padding: 12px 25px; border-radius: 30px; z-index: 2500; box-shadow: 0 5px 15px rgba(0,0,0,0.5); gap: 15px; align-items: center; }
    
