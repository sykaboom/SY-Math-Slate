<svg viewBox="0 0 1440 1080" xmlns="http://www.w3.org/2000/svg">
  <desc>Browser Chrome Resize Guard and Fullscreen State Diagram (1440x1080)</desc>
  <text x="10" y="20" font-family="monospace" font-size="12" fill="#666">Ratio: 4:3 | Fullscreen + Address Bar Jitter Guard</text>
  <rect width="1440" height="1080" fill="#020617" />

  <defs>
    <marker id="arrow" markerWidth="8" markerHeight="8" refX="6" refY="4" orient="auto" markerUnits="strokeWidth">
      <path d="M 0 0 L 8 4 L 0 8 z" fill="#94a3b8" />
    </marker>
  </defs>

  <!-- State: Browser Chrome Visible -->
  <g id="state_browser_chrome_visible" transform="translate(80, 90)">
    <rect width="420" height="310" rx="12" fill="#1e293b" stroke="#334155" />
    <text x="210" y="30" font-family="sans-serif" font-size="16" fill="white" text-anchor="middle">State: Browser Chrome Visible</text>
    <rect id="action_enter_fullscreen_ink" x="20" y="64" width="180" height="48" rx="6" fill="#3b82f6" />
    <text x="110" y="94" font-family="sans-serif" font-size="12" fill="white" text-anchor="middle">Enter Fullscreen Ink</text>
    <rect id="action_request_native_fullscreen" x="20" y="124" width="180" height="48" rx="6" fill="#2563eb" />
    <text x="110" y="154" font-family="sans-serif" font-size="12" fill="white" text-anchor="middle">Request Native Fullscreen</text>
  </g>

  <!-- State: Browser Chrome Hidden -->
  <g id="state_browser_chrome_hidden" transform="translate(80, 470)">
    <rect width="420" height="310" rx="12" fill="#0f172a" stroke="#f43f5e" />
    <text x="210" y="30" font-family="sans-serif" font-size="16" fill="#f43f5e" text-anchor="middle">State: Browser Chrome Hidden</text>
    <text x="210" y="145" font-family="monospace" font-size="12" fill="#94a3b8" text-anchor="middle">Guard: 100dvh + locked fallback (svh/app shell lock)</text>
    <text x="210" y="170" font-family="monospace" font-size="12" fill="#94a3b8" text-anchor="middle">Goal: no height spring during pen stroke</text>
  </g>

  <!-- State: Native Fullscreen -->
  <g id="state_native_fullscreen" transform="translate(940, 90)">
    <rect width="420" height="310" rx="12" fill="#065f46" stroke="#059669" />
    <text x="210" y="30" font-family="sans-serif" font-size="16" fill="white" text-anchor="middle">State: Native Fullscreen</text>
    <rect id="action_exit_fullscreen_ink" x="20" y="64" width="180" height="48" rx="6" fill="#f43f5e" />
    <text x="110" y="94" font-family="sans-serif" font-size="12" fill="white" text-anchor="middle">Exit Fullscreen Ink</text>
  </g>

  <!-- State: App Fullscreen Fallback -->
  <g id="state_app_fullscreen_fallback" transform="translate(940, 470)">
    <rect width="420" height="310" rx="12" fill="#4338ca" stroke="#6366f1" />
    <text x="210" y="30" font-family="sans-serif" font-size="16" fill="white" text-anchor="middle">State: App Fullscreen Fallback</text>
    <rect id="action_fallback_to_app_fullscreen" x="20" y="64" width="180" height="48" rx="6" fill="#6366f1" />
    <text x="110" y="94" font-family="sans-serif" font-size="12" fill="white" text-anchor="middle">Fallback Active</text>
  </g>

  <!-- Transitions -->
  <g stroke="#94a3b8" stroke-width="3" fill="none" marker-end="url(#arrow)">
    <path d="M 500 230 L 940 230" />
    <path d="M 500 260 C 700 320, 780 540, 940 610" />
    <path d="M 500 610 L 940 610" />
    <path d="M 940 700 C 770 780, 620 820, 500 700" />
  </g>
  <g font-family="monospace" font-size="12" fill="#94a3b8">
    <text x="710" y="215" text-anchor="middle">NATIVE SUCCESS</text>
    <text x="730" y="430" text-anchor="middle">NATIVE FAILURE</text>
    <text x="720" y="600" text-anchor="middle">FALLBACK ENTRY</text>
    <text x="700" y="770" text-anchor="middle">FALLBACK EXIT / RETURN</text>
  </g>

  <!-- Notes -->
  <g font-family="monospace" font-size="12" fill="#94a3b8">
    <text x="80" y="930">STRATEGY: Try native Fullscreen API first, fallback to app fullscreen if denied/unavailable.</text>
    <text x="80" y="952">JITTER GUARD: Use 100dvh as primary with guarded fallback lock for browser chrome show/hide.</text>
    <text x="80" y="980">Z-ORDER: app_base_canvas(0) &lt; overlays/tool_chrome(100) &lt; fullscreen_actions(200).</text>
    <text x="80" y="1002">EXIT PRIORITY: action_exit_fullscreen_ink must stay visible above overlays at all times.</text>
  </g>
</svg>
